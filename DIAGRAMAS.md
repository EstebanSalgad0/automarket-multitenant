# Diagramas del Proyecto Automarket Multitenant

## 1. Arquitectura General del Sistema

```mermaid
graph TB
    subgraph "Frontend - React + TypeScript"
        A[App.tsx] --> B[Components]
        A --> C[Hooks]
        A --> D[Services]
        
        B --> B1[VehiclesCatalog]
        B --> B2[UserProfile]
        B --> B3[DealerRegistration]
        B --> B4[SellerRegistration]
        
        C --> C1[useAuth]
        C --> C2[useVehicleCatalog]
        
        D --> D1[vehicleService]
    end
    
    subgraph "Backend Services"
        E[Supabase] --> E1[PostgreSQL]
        E --> E2[Auth]
        E --> E3[Storage]
        E --> E4[Real-time]
        
        F[Docker] --> F1[PostgreSQL Container]
        F --> F2[Adminer Container]
    end
    
    subgraph "Data Layer"
        G[Models] --> G1[BaseModel]
        G --> G2[User]
        G --> G3[Vehicle] 
        G --> G4[Tenant]
        G --> G5[ModelFactory]
    end
    
    D1 --> E
    C2 --> D1
    B1 --> C2
    G5 --> G2
    G5 --> G3
    G5 --> G4
    G2 --> G1
    G3 --> G1
    G4 --> G1
```

## 2. Modelo de Datos - Diagrama de Clases

```mermaid
classDiagram
    class BaseModel {
        <<abstract>>
        +id: string
        +created_at: Date
        +updated_at: Date
        +generateId(): string
        +touch(): void
        +toDatabase(): Record~string, any~*
        +validate(): ValidationResult*
        +toJSON(): Record~string, any~
    }
    
    class User {
        +tenant_id: string
        +email: string
        +phone?: string
        +user_type: UserType
        +status: UserStatus
        +email_verified_at?: Date
        +phone_verified_at?: Date
        +create(data: CreateUserData): User$
        +activate(): void
        +suspend(): void
        +verifyEmail(): void
        +verifyPhone(): void
        +changeUserType(type: UserType): void
        +isActive(): boolean
        +isVerified(): boolean
        +toDatabase(): Record~string, any~
        +validate(): ValidationResult
    }
    
    class Vehicle {
        +tenant_id: string
        +seller_id: string
        +make: string
        +model: string
        +year: number
        +price: number
        +currency: string
        +mileage: number
        +fuel_type: FuelType
        +transmission: TransmissionType
        +body_type: BodyType
        +color: string
        +description?: string
        +status: VehicleStatus
        +images: VehicleImage[]
        +features: VehicleFeature[]
        +location_city?: string
        +location_state?: string
        +vin?: string
        +license_plate?: string
        +create(data: CreateVehicleData): Vehicle$
        +updatePrice(newPrice: number): void
        +addImage(image: VehicleImage): void
        +removeImage(imageId: string): void
        +addFeature(feature: VehicleFeature): void
        +removeFeature(featureName: string): void
        +calculateDepreciation(): number
        +isAvailableForSale(): boolean
        +getPrimaryImage(): VehicleImage | null
        +markAsAvailable(): void
        +markAsSold(): void
        +markAsReserved(): void
        +toDatabase(): Record~string, any~
        +validate(): ValidationResult
    }
    
    class Tenant {
        +name: string
        +slug: string
        +country_code: string
        +currency: string
        +timezone: string
        +status: TenantStatus
        +create(data: CreateTenantData): Tenant$
        +activate(): void
        +deactivate(): void
        +setMaintenance(): void
        +updateCurrency(currency: string): void
        +updateTimezone(timezone: string): void
        +isActive(): boolean
        +generateSlug(): string
        +toDatabase(): Record~string, any~
        +validate(): ValidationResult
    }
    
    class ModelFactory {
        <<utility>>
        +createUser(data: any): User$
        +createVehicle(data: any): Vehicle$
        +createTenant(data: any): Tenant$
    }
    
    BaseModel <|-- User
    BaseModel <|-- Vehicle
    BaseModel <|-- Tenant
    ModelFactory ..> User : creates
    ModelFactory ..> Vehicle : creates
    ModelFactory ..> Tenant : creates
```

## 3. Diagrama de Arquitectura Multi-Tenant

```mermaid
graph TB
    subgraph "Multi-Tenant Architecture"
        subgraph "Tenant: Chile"
            T1[chile.automarket.com] --> D1[(Database: tenant_id='chile')]
            T1 --> U1[Users Chile]
            T1 --> V1[Vehicles Chile]
        end
        
        subgraph "Tenant: Argentina"
            T2[argentina.automarket.com] --> D2[(Database: tenant_id='argentina')]
            T2 --> U2[Users Argentina]
            T2 --> V2[Vehicles Argentina]
        end
        
        subgraph "Tenant: Mexico"
            T3[mexico.automarket.com] --> D3[(Database: tenant_id='mexico')]
            T3 --> U3[Users Mexico]
            T3 --> V3[Vehicles Mexico]
        end
    end
    
    subgraph "Shared Infrastructure"
        S1[Supabase]
        S2[PostgreSQL with RLS]
        S3[Authentication]
        S4[File Storage]
    end
    
    D1 --> S2
    D2 --> S2
    D3 --> S2
    T1 --> S1
    T2 --> S1
    T3 --> S1
    S1 --> S3
    S1 --> S4
```

## 4. Flujo de Datos - Vehicle Service

```mermaid
sequenceDiagram
    participant C as Component
    participant H as Hook (useVehicleCatalog)
    participant S as VehicleService
    participant M as ModelFactory
    participant D as Database/Mock
    
    C->>H: getVehicles(filters)
    H->>S: vehicleService.getVehicles(filters, limit, offset)
    S->>D: fetch vehicles data
    D->>S: raw data[]
    S->>M: ModelFactory.createVehicle(data)
    M->>S: Vehicle instance
    S->>H: VehicleWithDetails[]
    H->>C: vehicles state updated
    C->>C: render vehicle list
```

## 5. Diagrama de Estados - Vehicle

```mermaid
stateDiagram-v2
    [*] --> PENDING
    
    PENDING --> AVAILABLE : approve()
    PENDING --> SUSPENDED : reject()
    
    AVAILABLE --> RESERVED : reserve()
    AVAILABLE --> SOLD : sell()
    AVAILABLE --> SUSPENDED : suspend()
    
    RESERVED --> AVAILABLE : cancel_reservation()
    RESERVED --> SOLD : complete_sale()
    RESERVED --> SUSPENDED : suspend()
    
    SOLD --> [*]
    
    SUSPENDED --> AVAILABLE : reactivate()
    SUSPENDED --> [*] : delete()
```

## 6. Estructura de Carpetas

```
üìÅ automarket-multitenant/
‚îú‚îÄ‚îÄ üìÅ app/                          # Frontend React
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/               # Domain Models
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ BaseModel.ts      # Abstract base class
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ User.ts           # User model
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Vehicle.ts        # Vehicle model
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Tenant.ts         # Tenant model
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ index.ts          # ModelFactory + exports
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ services/             # Business Logic Layer
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ vehicleServiceNew.ts # Vehicle operations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ hooks/                # React Hooks
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ useAuth.ts        # Authentication
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ useVehicleCatalog.ts # Vehicle catalog
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ components/           # UI Components
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ VehiclesCatalog.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ UserProfile.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ DealerRegistration.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ SellerRegistration.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ lib/                  # External Services
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ supabase.ts       # Supabase client
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ database.types.ts # DB type definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ utils/                # Utilities & Testing
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ quickTest.ts      # Model tests
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ modelsDemo.ts     # Demo scenarios
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ nodeTest.js       # Node.js test
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ App.tsx               # Main component
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ main.tsx              # Entry point
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ vite-env.d.ts         # Vite types
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ package.json              # Dependencies
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ tsconfig.json             # TypeScript config
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ vite.config.ts            # Vite config
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ index.html                # HTML template
‚îú‚îÄ‚îÄ üìÅ api/                          # Backend API (Future)
‚îú‚îÄ‚îÄ üìÅ db/                           # Database scripts
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ init.sql                  # Initial schema
‚îú‚îÄ‚îÄ üìÅ supabase/                     # Supabase config
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ schema.sql                # Database schema
‚îú‚îÄ‚îÄ üìÑ docker-compose.yml            # Docker services
‚îú‚îÄ‚îÄ üìÑ README.md                     # Project documentation
‚îî‚îÄ‚îÄ üìÑ RESUMEN_COMPLETO.txt          # Complete summary
```

## 7. Diagrama de Dependencias

```mermaid
graph LR
    subgraph "External Dependencies"
        R[React] 
        T[TypeScript]
        V[Vite]
        S[Supabase]
        D[Docker]
    end
    
    subgraph "Internal Modules"
        M[Models] --> MF[ModelFactory]
        SE[Services] --> M
        H[Hooks] --> SE
        C[Components] --> H
        A[App] --> C
    end
    
    subgraph "Configuration"
        TC[tsconfig.json]
        VC[vite.config.ts]
        PC[package.json]
        DC[docker-compose.yml]
    end
    
    A --> R
    M --> T
    SE --> S
    H --> R
    C --> R
    
    TC --> T
    VC --> V
    PC --> R
    DC --> D
```

## 8. Diagrama de Casos de Uso

```mermaid
graph TB
    subgraph "Actores"
        B[Buyer - Comprador]
        S[Seller - Vendedor]
        D[Dealer - Concesionario]
        A[Admin - Administrador]
    end
    
    subgraph "Casos de Uso - Buyer"
        UC1[Buscar Veh√≠culos]
        UC2[Filtrar por Criterios]
        UC3[Ver Detalles del Veh√≠culo]
        UC4[Agregar a Favoritos]
        UC5[Contactar Vendedor]
    end
    
    subgraph "Casos de Uso - Seller"
        UC6[Registrar Veh√≠culo]
        UC7[Actualizar Informaci√≥n]
        UC8[Subir Im√°genes]
        UC9[Gestionar Consultas]
        UC10[Marcar como Vendido]
    end
    
    subgraph "Casos de Uso - Dealer"
        UC11[Gestionar Inventario]
        UC12[Publicar Multiple Veh√≠culos]
        UC13[Gestionar Perfil de Empresa]
        UC14[Ver Estad√≠sticas]
    end
    
    subgraph "Casos de Uso - Admin"
        UC15[Gestionar Tenants]
        UC16[Moderar Contenido]
        UC17[Ver Analytics]
        UC18[Configurar Sistema]
    end
    
    B --> UC1
    B --> UC2
    B --> UC3
    B --> UC4
    B --> UC5
    
    S --> UC6
    S --> UC7
    S --> UC8
    S --> UC9
    S --> UC10
    
    D --> UC11
    D --> UC12
    D --> UC13
    D --> UC14
    
    A --> UC15
    A --> UC16
    A --> UC17
    A --> UC18
```